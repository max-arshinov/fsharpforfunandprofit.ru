---
layout: page
title: "Установка и использование F#"
nav:
hasComments: 1
image: "/installing-and-using/fsharp_eval2.png"
date: 2014-01-01
---

Компилятор F# это свободный инструмент с открытым исходным кодом, который доступен для Windows, Max и Linux (благодаря Mono).
Узнайте больше о F# и о том, как его установить в [Фонде F#](http://fsharp.org/).

Мы можете использовать его в интегрированных средах разработки (IDE — Visual Studio, MonoDevelop), или в вашем любимом редакторе (VS Code и Atom имеют особенно хорошую поддержку F# благодаря [Ionide](http://ionide.io)), или просто как самостоятельный компилятор в командной строке.

Если вы не хотите ничего устанавливать, вы можете попробовать [.NET Fiddle](https://dotnetfiddle.net/), сайт, который предоставляет интерактивную среду, где вы можете исследовать F# в вашем браузере.
Там вы сможете запустить большую часть кода с этого сайта.

## Как работать с примерами кода ##

Как только вы установили и запустили F#, вы можете самостоятельно изучать примеры кода.

Лушчий способ запускть примеры с этого сайта, это вводить код в файл сценария `.FSX`, который вы затем можете отправить в окно "F# Interactive" для выполнения.
Либо вы можете вводить примеры непосредственно в консольное окно "F# Interactive".
Я бы рекомендовал подход с файлом скрипта для всего, что больше одной или двух строк кода.

Код больших примеров доступен для загрузки с этого сайта — ссылки будут в посте.

Наконец, я бы предложил вам поиграть с примерами и вносить в них изменения.
Если вы получите ошибку компилятора, проверьте страницу ["Исправление ошибок F#"](/troubleshooting-fsharp/), которая объясняет наиболее общие проблемы, и как их исправить.

### Содержание ###

* [Установка F#](#installing-fsharp)
* Использование F# с различными инструментами
  * [Использование F# с Visual Studio](#visual-studio)
  * [Использование F# с Mono на Linux и Mac](#mono-develop)
  * [Попробуйте F# прямо в вашем браузере](#browser)
  * [Использование F# в интерактивной оболочке FSI](#interactive-shell)
  * [Использование F# в SharpDevelop](#sharp-develop)
* [Ошибки компиляции](#compilation-errors)
* [Проекты и решения](#projects-solutions)
* [Использование F# в скриптах оболочки](#shell-scripts)

{{< linktarget "installing-fsharp" >}}

## Установка F# ##

Вы можете [взять F# для множества платформ здесь](http://fsxplat.codeplex.com/).
После того, как вы скачаете и установите F#, вы можете рассмотреть возможность установки [F# power pack](http://fsharppowerpack.codeplex.com), который предоставляет несколько интересных расширений, и этот сайт будет ссылаться на некоторые из них.

{{< linktarget "visual-studio" >}}

## Использование F# в Visual Studio ##

Если вы работаете на платформе Windows, использование Visual Studio для разработки на F# настойчиво рекомендуется, так как F# отлично интегрирован с IDE, отладчиком и т.д.

* Если у вас Visual Studio 2010 или выше, F# уже включён.
* Если у вас Visual Studio 2008, вы можете скачать установку F# с MSDN.
* Если у вас ни то, и не другое, вы можете установить "Изолированную оболочку Visual Studio" и затем установить F# в неё.

После того, как вы установили F#, вы должны создать проект F#.

![Новый проект](./fsharp_new_project2.png)

И затем создать файл скрипта (FSX) для запуска в нём примеров.

![Новый сценарий FSX](./fsharp_new_script2.png)

Далее, убедитесь в том, что интерактивное окно F# активно (обычно через `Вид > Другие окна > F# Interactive`).

Использование файла скрипта это простейший путь экспериментировать с F#; просто набираете любой код в окно сценария и запускайте его, чтобы увидеть результат в интерактивном окне ниже.
Чтобы запустить выделенный код, вы можете:

* Щёлкните правой кнопкой, чтобы вызывать контексное меню и выберите "Выполнение в интерактивном режиме" ("Execute In Interactive"). Имейте в виду, что если интерактивное окно F# невидимо, опция меню "Execute In Interactive" будет недоступна.
* Используйте комбинацию клавиш `Alt+Enter` (но смотрите замечание ниже про клавиатурные назначения).

![Выполнить в интерактивном окне](./send_to_interactive.png)

{{< alerterror >}}

### Внимание! Resharper ###

Если вы установили Resharper или другие расширения, комбинация клавиш `Alt+Enter` может быть назначена другой команде.
В этом случае многие люди вместо неё назначают команду на `Alt+;` (точка с запятой).

Вы можете переназначаить команду в меню Visual Studio `Средства > Параметры > Окружение > Клавиатура`, где команда "Выполнение в интерактивном режиме" называется `EditorContextMenus.CodeWindow.ExecuteInInteractive`.

{{< /alerterror >}}

Вы можете также работать непосредственно в интерактивном окне.
Но в этом случае вы должны всегда завершать блок кода двумя точками с запятой.

![Интерактивное окно](./fsharp_interactive2.png)

{{< linktarget "mono-develop" >}}

## Использование F# с Mono на Linux и Mac ##

F# включён в Mono с момента выпуска Mono 3.0.2.
[Скачать Mono здесь](http://www.go-mono.com/mono-downloads/download.html).

Как только вы установили Mono, вы можете использовать среду разработки MonoDevelop или свой любимый редактор, например, Emacs.

* Поддержка F# уже интегрирована в [MonoDevelop](http://monodevelop.com/).
  Смотрите [http://addins.monodevelop.com/Project/Index/48](http://addins.monodevelop.com/Project/Index/48).
* В Emacs есть режим F#, который добавляет подсветку синтаксиса F#.
  Смотрите страницу ["F# cross-platform packages and samples"](http://fsxplat.codeplex.com/) на Codeplex.

{{< linktarget "browser" >}}

## Попробуйте F# прямо в своём браузере ##

Если вы не хотите ничего скачивать, вы можете попробовать F# непосредственно в своём браузере.
Нужный сайт находится по адресу [try.fsharp.org](https://try.fsharp.org/).
Обратите внимание, что он требует Silverlight для своей работы.

![F# в браузере](./fsharp_web2.png)

{{< linktarget "interactive-shell" >}}

## Использование F# в командной строке ##

F# имеет простую интерактивную консоль, именуемую FSI.exe, которая также может быть использована для запуска кода.
Точно также, как и в интерактивном окне Visual Studio, вы должны завершать каждый блок кода двумя точками с запятой.

![FSI](./fsharp_fsi2.png)

{{< linktarget "sharp-develop" >}}

## Использование F# в SharpDevelop ##

[SharpDevelop](http://www.icsharpcode.net/OpenSource/SD/) имеет некоторую поддержку F#.
Вы можете создать проект на F#, и уже в нём создать файл сценария FSX.
После этого введите код в окне скрипта и используйте контекстное меню, чтобы отправить код в интерактивное окно (как показано ниже).

![Отправить в интерактивное окно](./fsharp_eval_sharpdevelop2.png)

{{< linktarget "compilation-errors" >}}

## Ошибки компиляции? ##

Если при компиляции вашего кода возникли проблемы, страница ["Исправление ошибок F#"](/troubleshooting-fsharp/) может оказаться полезной.

{{< linktarget "projects-solutions" >}}

## Проекты и Решения ##

F# использует точно такую же модель "проектов" и "решений", как и C#, так что если она вам хорошо знакома, вы достаточно легко сможете создать исполняемое приложение на F#.

Чтобы создать файл, который будет компилироваться, как часть проекта, вместо файлов скрипта используйте файлы с расширенем `.fs`. Файлы `.fsx` компилироваться не будут.

Тем не менее, проекты F# имеют несколько важных отличий от C#:

* Файлы F# организованы *линейно*, а не в иерархию папок и подпапок. По файту, в проектах на F# нет опции "создать папку"! В целом, это не проблема, поскольку, в отличие от C#, файлы в F# могут содержать больше одного класса. То, что может быть целой папкой с классами в C#, в F# может быть одним файлом.
* *Порядок файлов в проекте очень важен*: более "поздние" файлы F# могут обращаться к публичным типам, определённые в более "ранних" файлах F#, но не наоборот. Как следствие, вы не можете иметь никаких циклических зависимостей между файлами.
* Вы можете изменять порядок файлов по правой кнопке мыши, выполняя "Вверх" ("Move Up") или "Вниз" ("Move Down").  Точно также, создавая новый файл, вы можете выбрать "Добавить выше" ("Add Above") или "Добавить ниже" ("Add Below") существующего файла.

{{< linktarget "shell-scripts" >}}

## Сценарии оболочки на F# ##

Вы также можете использовать F#, как язык для написания скриптов, вместо того, чтобы компилировать код в EXE.
Это делается с помощью программы FSI, которая не только работает в режиме консоли, но также может быть использована для запуска скриптов тем же способом, как вы можете использовать Python или Powershell.

Это очень удобно когда вы хотите быстро запустить какой-то код без компиляции в полноценное приложение.
Система автоматизации сборки F# ["FAKE"](https://github.com/fsharp/FAKE) показывает, насколько это может быть полезным.

Чтобы увидеть, как вы можете сделать это сами, я написал для вас примерчик скрипта, который скачивает веб-страницу в локальный файл.
Сначала создайте файл скрипта FSX — назовём его "`ShellScriptExample.fsx`" — и скопируйте туда этот код.

```fsharp
// ================================
// Описание:
//    скачивает страницу по указанному адресу и сохраняет её в файл,
//    добавляя к его имени дату и время скачивания
//
// Пример вызова:
//    fsi ShellScriptExample.fsx http://google.com google
// ================================

// инструкция "open" добавляет в область видимости указанное пространство имён
open System.Net
open System

// скачать содержимое страницы
let downloadUriToFile url targetfile =
    let req = WebRequest.Create(Uri(url))
    use resp = req.GetResponse()
    use stream = resp.GetResponseStream()
    use reader = new IO.StreamReader(stream)
    let timestamp = DateTime.UtcNow.ToString("yyyy-MM-ddTHH-mm")
    let path = sprintf "%s.%s.html" targetfile timestamp
    use writer = new IO.StreamWriter(path)
    writer.Write(reader.ReadToEnd())
    printfn "finished downloading %s to %s" url path

// При запуске из FSI сначала идёт имя сценария, а затем уже другие аргументы командной строки
match fsi.CommandLineArgs with
    | [| scriptName; url; targetfile |] ->
        printfn "running script: %s" scriptName
        downloadUriToFile url targetfile
    | _ ->
        printfn "USAGE: [url] [targetfile]"
```

Не беспокойтесь прямо сейчас о том, как работает этот код.
В любом случае, он достаточно сырой, и в лучшем примере следовало бы добавить обработку ошибок и подобные вещи.

Чтобы запустить этот скрипт, откройте командную строку в том же каталоге, и наберите:

```shell
fsi ShellScriptExample.fsx http://google.com google_homepage
```

Пока вы играете с кодом на этом сайте, вы можете заодно поэкспериментировать, создавая собственные сценарии.
